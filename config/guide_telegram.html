<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Guide ‚Äî Connexion Telegram (Macro COC)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --bg:#0b1220;--card:#0e1624;--muted:#94a3b8;--text:#e5e7eb;--accent:#80b7f7;--ok:#22c55e;--warn:#eab308;--danger:#ef4444;
  --border:#273244;--chip:#1f2937;--shadow:0 6px 20px rgba(0,0,0,.25);
}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;margin:0;padding:24px}
h1,h2,h3{color:#fff;margin:0 0 12px}
p,li{color:var(--text)}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}
.container{max-width:1100px;margin:0 auto}
.card{background:var(--card);border-radius:12px;padding:16px;margin:16px 0;box-shadow:var(--shadow)}
.badge{display:inline-block;font-size:12px;padding:2px 8px;border-radius:999px;background:var(--chip);color:#cbd5e1;margin-left:8px}
.note{background:#132033;padding:12px;border-radius:10px}
kbd{background:#1f2937;padding:2px 6px;border-radius:4px;border:1px solid #374151}
pre{background:#111827;color:#e5e7eb;padding:12px;border-radius:10px;overflow:auto}
code{background:#111827;color:#e5e7eb;padding:2px 6px;border-radius:6px}
ul{margin:8px 0 8px 22px}
ol{margin:8px 0 8px 22px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border:1px solid var(--border);padding:8px 10px;text-align:left}
.small{color:var(--muted);font-size:14px}
.hero{display:flex;gap:14px;align-items:center;margin-bottom:10px}
.hero .dot{width:10px;height:10px;border-radius:50%;background:var(--ok)}
.t-ok{color:var(--ok)} .t-warn{color:var(--warn)} .t-danger{color:var(--danger)}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{background:var(--chip);color:#cbd5e1;border:1px solid #314055;border-radius:999px;padding:2px 8px;font-size:12px}
.toc a{display:block;padding:6px 10px;border-radius:8px;background:#0e1524;color:#d1d5db;margin:6px 0}
.toc a:hover{background:#12213a}
.section h2{scroll-margin-top:18px}
.hr{height:1px;background:var(--border);margin:18px 0}
.footer{opacity:.8;margin-top:28px}
</style>
</head>
<body>
<div class="container">

  <div class="hero">
    <div class="dot"></div>
    <h1>Connexion Telegram ‚Äî guide complet</h1>
    <span class="badge">Macro COC</span>
  </div>

  <div class="note">
    <b>Important :</b> un seul consommateur de <code>getUpdates</code> √† la fois. Ferme l‚Äôapplication <i>Macro COC</i> avant d‚Äôouvrir l‚ÄôURL <code>getUpdates</code>, sinon Telegram renverra souvent une erreur <b>409</b> (conflit entre webhook et polling ou pollers concurrents).
  </div>

  <div class="card toc">
    <h2>Sommaire</h2>
    <a href="#concepts">1. Concepts cl√©s</a>
    <a href="#creation-bot">2. Cr√©er le bot avec <b>@BotFather</b></a>
    <a href="#chatid">3. R√©cup√©rer votre <b>chat_id</b></a>
    <a href="#config-app">4. Configurer l‚Äôapplication Macro COC</a>
    <a href="#commandes">5. Commandes et boutons disponibles</a>
    <a href="#tests">6. Tests API rapides (curl / PowerShell)</a>
    <a href="#erreurs">7. D√©pannage erreurs courantes</a>
    <a href="#securite">8. S√©curit√© et bonnes pratiques</a>
  </div>

  <div id="concepts" class="card section">
    <h2>1. Concepts cl√©s</h2>
    <ul>
      <li><b>Bot Telegram</b> : un compte automatis√© que vous pilotez via l‚ÄôAPI Bot.</li>
      <li><b>Token</b> : secret donn√© par <a href="https://t.me/BotFather" target="_blank" rel="noopener noreferrer">@BotFather</a> pour authentifier votre bot.</li>
      <li><b>chat_id</b> : identifiant num√©rique d‚Äôun chat priv√© ou d‚Äôun groupe o√π le bot enverra des messages.</li>
      <li><b>Polling</b> : l‚Äôapp interroge r√©guli√®rement l‚ÄôAPI via <code>getUpdates</code>. Ne pas utiliser en m√™me temps qu‚Äôun <b>webhook</b>.</li>
    </ul>
    <div class="chips">
      <span class="chip">Bot API</span><span class="chip">getUpdates</span><span class="chip">sendMessage</span><span class="chip">sendPhoto</span><span class="chip">inline keyboard</span>
    </div>
  </div>

  <div id="creation-bot" class="card section">
    <h2>2. Cr√©er le bot avec @BotFather</h2>
    <ol>
      <li>Ouvrez <a href="https://t.me/BotFather" target="_blank" rel="noopener noreferrer"><b>@BotFather</b></a> dans Telegram.</li>
      <li>Envoyez <code>/newbot</code>, d√©finissez un <b>nom</b> et un <b>username</b> se terminant par <code>bot</code>.</li>
      <li>Copiez le <b>token</b> affich√©. Conservez-le en s√©curit√©.</li>
      <li>Si besoin, r√©g√©n√©rez le token avec <code>/revoke</code> puis <code>/token</code> sur BotFather.</li>
    </ol>
    <p class="small">Documentation : <a href="https://core.telegram.org/bots" target="_blank" rel="noopener noreferrer">core.telegram.org/bots</a> ‚Ä¢ API : <a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener noreferrer">core.telegram.org/bots/api</a></p>
  </div>

  <div id="chatid" class="card section">
    <h2>3. R√©cup√©rer votre <code>chat_id</code></h2>
    <ol>
      <li>Parlez √† votre bot : cliquez le lien fourni par BotFather puis envoyez <code>/start</code>.</li>
      <li><b>Fermez</b> l‚Äôapp Macro COC si elle tourne.</li>
      <li>Dans votre navigateur, ouvrez :<br>
        <code>https://api.telegram.org/bot&lt;VOTRE_TOKEN&gt;/getUpdates</code>
      </li>
      <li>Trouvez le champ <code><b>chat</b></code> dans la r√©ponse JSON et copiez <code><b>id</b></code> (valeur num√©rique).</li>
    </ol>
    <pre>{
  "ok": true,
  "result": [{
    "update_id": 123456789,
    "message": {
      "chat": { "id": <span class="t-ok">1234567890</span>, "type": "private", "first_name": "Vous" },
      "text": "/start"
    }
  }]
}</pre>
    <p class="small">Conflit 409 ? Supprimez un √©ventuel webhook : <code>https://api.telegram.org/bot&lt;TOKEN&gt;/deleteWebhook</code></p>
  </div>

  <div id="config-app" class="card section">
    <h2>4. Configurer l‚Äôapplication Macro COC</h2>
    <ol>
      <li>Ouvrez l‚Äôapp ‚Üí <b>Param√®tres</b> ‚Üí <b>Automatisation Telegram</b>.</li>
      <li>Collez votre <b>token</b> et votre <b>chat_id</b>. Cliquez <b>Enregistrer</b>.</li>
      <li>Au d√©marrage, l‚Äôapp purge le backlog Telegram et affiche un clavier <i>inline</i> dans votre chat.</li>
    </ol>
    <div class="note">Astuce : activez ou non la <b>lecture en boucle</b> depuis Param√®tres ou depuis Telegram (voir section 5).</div>
  </div>

  <div id="commandes" class="card section">
    <h2>5. Commandes et boutons disponibles</h2>
    <table class="table">
      <thead><tr><th>Action</th><th>Texte √† envoyer</th><th>Bouton inline</th><th>Effet</th></tr></thead>
      <tbody>
        <tr><td>Lire</td><td><code>go</code></td><td>Go ‚úÖ</td><td>Lance la macro s√©lectionn√©e</td></tr>
        <tr><td>Stop</td><td><code>stop</code></td><td>Stop ‚ùå</td><td>Arr√™te enregistrement/lecture</td></tr>
        <tr><td>Menu</td><td><code>menu</code></td><td>Param√®tres ‚öôÔ∏è</td><td>Ouvre le sous-menu</td></tr>
        <tr><td>Retour</td><td><code>back</code></td><td>‚¨ÖÔ∏è Retour</td><td>Revient aux commandes</td></tr>
        <tr><td>Lancer CoC</td><td><code>launch</code> (bouton)</td><td>Lancer CoC</td><td>D√©marre CoC une fois</td></tr>
        <tr><td>Recharger CoC</td><td><code>reload</code> (bouton)</td><td>Recharger CoC</td><td>Joue la macro prot√©g√©e <b>Recharger COC</b></td></tr>
        <tr><td>Loop</td><td><code>loop_on</code>/<code>loop_off</code></td><td>Loop ON/OFF</td><td>Bascule la lecture en boucle</td></tr>
        <tr><td>Capture unique</td><td><code>capture</code></td><td>Capture üì∏</td><td>Envoie une capture imm√©diate</td></tr>
        <tr><td>√âteindre PC</td><td><code>shutdown</code></td><td>√âteindre ‚Üí Confirmer</td><td>Demande confirmation puis √©teint</td></tr>
        <tr><td>Choisir macro</td><td>‚Äî</td><td>Choisir macro</td><td>Affiche la liste des macros en boutons</td></tr>
      </tbody>
    </table>
    <div class="small">La liste exacte d√©pend de votre version. Les boutons <i>inline</i> sont r√©g√©n√©r√©s apr√®s chaque action.</div>
  </div>

  <div id="tests" class="card section">
    <h2>6. Tests API rapides</h2>
    <h3>curl</h3>
<pre>curl -s "https://api.telegram.org/bot&lt;TOKEN&gt;/getMe"
curl -s "https://api.telegram.org/bot&lt;TOKEN&gt;/sendMessage" -d "chat_id=&lt;CHAT_ID&gt;&text=Hello"</pre>
    <h3>PowerShell</h3>
<pre>$uri = "https://api.telegram.org/bot&lt;TOKEN&gt;/sendMessage"
Invoke-RestMethod -Uri $uri -Method Post -Body @{ chat_id="&lt;CHAT_ID&gt;"; text="Hello" }</pre>
    <h3>Envoyer une photo (multipart, curl)</h3>
<pre>curl -s -F "chat_id=&lt;CHAT_ID&gt;" -F "photo=@screenshot.png" \
  "https://api.telegram.org/bot&lt;TOKEN&gt;/sendPhoto"</pre>
    <p class="small">R√©f√©rence officielle : <a href="https://core.telegram.org/bots/api#available-methods" target="_blank" rel="noopener noreferrer">m√©thodes Bot API</a></p>
  </div>

  <div id="erreurs" class="card section">
    <h2>7. D√©pannage erreurs courantes</h2>
    <table class="table">
      <thead><tr><th>Sympt√¥me</th><th>Cause probable</th><th>Rem√®de</th></tr></thead>
      <tbody>
        <tr><td><b>401 Unauthorized</b></td><td>Token invalide</td><td>R√©g√©n√©rez le token sur <b>@BotFather</b> et mettez √† jour l‚Äôapp</td></tr>
        <tr><td><b>403 Forbidden</b></td><td>Le bot est bloqu√© par l‚Äôutilisateur</td><td>Ouvrez la conversation et cliquez <b>Start</b></td></tr>
        <tr><td><b>400 Bad Request</b></td><td><code>chat_id</code> erron√© ou payload incomplet</td><td>V√©rifiez l‚ÄôID et les champs requis</td></tr>
        <tr><td><b>409 Conflict</b></td><td>Webhook actif ou second poller</td><td><a href="https://api.telegram.org/bot&lt;TOKEN&gt;/deleteWebhook" target="_blank" rel="noopener noreferrer">deleteWebhook</a> puis relancez</td></tr>
        <tr><td><b>429 Too Many Requests</b></td><td>Limites API d√©pass√©es</td><td>Ralentir les envois, ajouter un backoff</td></tr>
      </tbody>
    </table>
    <div class="note">Si aucune mise √† jour ne remonte, envoyez un message au bot, attendez 2‚Äì3 s puis relancez <code>getUpdates</code>.</div>
  </div>

  <div id="securite" class="card section">
    <h2>8. S√©curit√© et bonnes pratiques</h2>
    <ul>
      <li>Ne partagez <b>jamais</b> votre token. Traitez-le comme un mot de passe.</li>
      <li>En cas de doute, r√©voquez le token sur <b>@BotFather</b> et mettez √† jour l‚Äôapp.</li>
      <li>√âvitez de publier <code>data.csv</code> avec le token sur un d√©p√¥t public.</li>
      <li>Si vous activez des captures automatiques, v√©rifiez ce qui peut appara√Ætre √† l‚Äô√©cran.</li>
    </ul>
  </div>

  <div class="footer small">
    ¬© Macro COC ‚Äî Guide local ‚Ä¢ Docs officielles : <a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener noreferrer">Bot API</a>
  </div>

</div>
</body>
</html>